(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{366:function(t,n,a){"use strict";a.r(n);var s=a(43),e=Object(s.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"chapter-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter-2"}},[t._v("#")]),t._v(" Chapter 2")]),t._v(" "),a("p",[t._v("Working with Tezos RPC: networks, chains, blocks, operations, and context.")]),t._v(" "),a("p",[t._v("In this chapter we will explore main blockchain structures and how to query them using PyTezos."),a("br"),t._v("\nTezos node software is built in a "),a("a",{attrs:{href:"https://tezos.gitlab.io/whitedoc/the_big_picture.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("modular way"),a("OutboundLink")],1),t._v(", there is a generic "),a("strong",[t._v("Shell")]),t._v(" which is responsible for basic block validation, p2p, storage, and "),a("strong",[t._v("Protocol")]),t._v(" that contains main logic. Thanks to the "),a("a",{attrs:{href:"https://learn.tqtezos.com/files/self-amendment.html#introduction",target:"_blank",rel:"noopener noreferrer"}},[t._v("self-amendment"),a("OutboundLink")],1),t._v(" feature this protocol code can be changed up to a complete replacement. RPC interface provided by the Tezos node reflects this architecture:")]),t._v(" "),a("ul",[a("li",[t._v("There are shell-level endpoints that don't depend on a particular protocol;")]),t._v(" "),a("li",[t._v("There are block-level endpoints which can response differently depending on the protocol version (block level).")])]),t._v(" "),a("p",[t._v('PyTezos wrapper reflects the RPC endpoint scheme and provides so called "chaining" interface for creating requests. For instance if you want to query '),a("code",[t._v("GET /a/b/c/d")]),t._v(" it would be "),a("code",[t._v("a.b.c.d()")]),t._v(". If it's a "),a("code",[t._v("POST")]),t._v(" request it would be "),a("code",[t._v("a.b.c.d.post()")]),t._v(". RPC documentation is integrated to the query engine and you can check available methods on each step, just execute e.g. "),a("code",[t._v("a.b.c")]),t._v(" in a notebook cell.")]),t._v(" "),a("h2",{attrs:{id:"network"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#network"}},[t._v("#")]),t._v(" Network")]),t._v(" "),a("p",[t._v("Before moving on to playing with RPC we need to connect to one of Tezos networks. Aside from the "),a("code",[t._v("mainnet")]),t._v(" which carries value, there are several public "),a("a",{attrs:{href:"https://tezos.gitlab.io/introduction/test_networks.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("testnets"),a("OutboundLink")],1),t._v(", plus anyone can spawn his own "),a("a",{attrs:{href:"https://tezos.gitlab.io/developer/flextesa.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("sandboxnet"),a("OutboundLink")],1),t._v(" e.g. for debugging dapps.")]),t._v(" "),a("p",[t._v("First of all we create a PyTezos client instance and initialize the network (by default it uses the network with latest known protocol activated):")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pytezos "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytezos\n\npytezos "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("using"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mainnet'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uri\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("'https://rpc.tzkt.io/mainnet/'")])]),t._v(" "),a("p",[t._v("It can also be node uri:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("using"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://mainnet-tezos.giganode.io/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Note that "),a("code",[t._v("using")]),t._v(" method returns a new instance of PyTezos client and does not modifies the existing one.")]),t._v(" "),a("h2",{attrs:{id:"chain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chain"}},[t._v("#")]),t._v(" Chain")]),t._v(" "),a("p",[t._v("There can be multiple chains at a particular moment in a single network:")]),t._v(" "),a("ul",[a("li",[t._v("There is a special testing period in the voting process during which new protocol is battle tested but detached from the real funds.")]),t._v(" "),a("li",[t._v("Due to network delays or other reasons two or more block producers can simultaneously extend main chain essentially creating forks. With time (usually 1-2 blocks) all such chains except one with the highest "),a("a",{attrs:{href:"https://tezos.gitlab.io/whitedoc/proof_of_stake.html?highlight=fitness#fitness",target:"_blank",rel:"noopener noreferrer"}},[t._v('"fitness"'),a("OutboundLink")],1),t._v(" become orphans (not adopted by others) and then obsolete.")])]),t._v(" "),a("p",[t._v("Keep in mind, that your RPC provider can be at an orphan state at some point of time and rollback only after several minutes.")]),t._v(" "),a("p",[t._v("Most time you will work with the "),a("code",[t._v("main")]),t._v(" chain:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chains"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("<pytezos.rpc.shell.ChainQuery object at 0x7fcf48d768d0>\n"),a("p",[t._v("Properties\n.path  # /chains/main\n.node  # https://mainnet-tezos.giganode.io/ ()")]),t._v("\n"),a("p",[t._v("RPC endpoints\n.blocks\n.chain_id\n.checkpoint\n.invalid_blocks\n.mempool")]),t._v("\n"),a("p",[t._v("Helpers\n.watermark()")])])]),a("p"),t._v(" "),a("p",[t._v("Note the output — this is the builtin documentation mentioned earlier. In particular list of RPC methods is useful for exploration or if you forget something.")]),t._v(" "),a("h2",{attrs:{id:"block"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block"}},[t._v("#")]),t._v(" Block")]),t._v(" "),a("p",[t._v("Blocks can be accessed by hash, level (height), special identifiers ("),a("code",[t._v("head")]),t._v(", "),a("code",[t._v("genesis")]),t._v("), or offsets ("),a("code",[t._v("head-123")]),t._v(", "),a("code",[t._v("head+123")]),t._v(")."),a("br"),t._v("\nIn a nutshell, block consists of a header and a list of operations. Block hash (blake2b) is actually derived from the byte representation of its header.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chains"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blocks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("'BLP93MhbrKvMKLsBuy8UErpwn1QYVCR7DHwhD3geWfXgemZY3jm'")])]),t._v(" "),a("p",[t._v("There are useful shortcuts for most common scenarios, e.g. accessing head.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("{'protocol': 'PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb',\n 'chain_id': 'NetXdQprcVkpaWU',\n 'hash': 'BLP93MhbrKvMKLsBuy8UErpwn1QYVCR7DHwhD3geWfXgemZY3jm',\n 'level': 1131056,\n 'proto': 6,\n 'predecessor': 'BKkHEv6Qq4cWo14QkfQSNFpWiczCxtZvBGUgmRrD62DEf8YbHwj',\n 'timestamp': '2020-09-16T15:51:58Z',\n 'validation_pass': 4,\n 'operations_hash': 'LLobEPiM5zFMSwFQVMxttzS9sTtBJPhqp5Q7shkhp5ZpxFVk8TGDL',\n 'fitness': ['01', '0000000000074230'],\n 'context': 'CoV64qaFykBGjNzStJDdTu7NyCPrmPVMPRmFFHVYrdzS1zrGxiZD',\n 'priority': 0,\n 'proof_of_work_nonce': 'ba45727c3e590600',\n 'signature': 'siga8iyjVFyKDkycPSSX47hs4S9byVPEtScXsL5C82yuWD1Xm4qDDKkJvUTjuQUhE5Uwk4NiqiXHfQq53EoRwwrUJpxxQ9vA'}")])]),t._v(" "),a("p",[t._v('Block header fields are also divided into "shell" (protocol independent) and protocol-specific.'),a("br"),t._v("\nRead detailed description of each field in the "),a("a",{attrs:{href:"https://tezos.gitlab.io/whitedoc/proof_of_stake.html#blocks",target:"_blank",rel:"noopener noreferrer"}},[t._v("whitedoc"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("A useful source of information is the block receipt containing state changes happened in the result of applying this block. There are also operation receipts which we will examine a bit later.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blocks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("{'protocol': 'PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY',\n 'next_protocol': 'PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY',\n 'test_chain_status': {'status': 'not_running'},\n 'max_operations_ttl': 60,\n 'max_operation_data_length': 16384,\n 'max_block_header_length': 238,\n 'max_operation_list_length': [{'max_size': 32768, 'max_op': 32},\n  {'max_size': 32768},\n  {'max_size': 135168, 'max_op': 132},\n  {'max_size': 524288}],\n 'baker': 'tz3RDC3Jdn4j15J7bBHZd29EUee9gVB1CxD9',\n 'level': {'level': 10000,\n  'level_position': 9999,\n  'cycle': 2,\n  'cycle_position': 1807,\n  'voting_period': 0,\n  'voting_period_position': 9999,\n  'expected_commitment': False},\n 'voting_period_kind': 'proposal',\n 'nonce_hash': None,\n 'consumed_gas': '0',\n 'deactivated': [],\n 'balance_updates': [{'kind': 'contract',\n   'contract': 'tz3RDC3Jdn4j15J7bBHZd29EUee9gVB1CxD9',\n   'change': '-16000000'},\n  {'kind': 'freezer',\n   'category': 'deposits',\n   'delegate': 'tz3RDC3Jdn4j15J7bBHZd29EUee9gVB1CxD9',\n   'level': 2,\n   'change': '16000000'}]}")])]),t._v(" "),a("p",[t._v("In order to better understand what receipt fields mean, check out the articles about "),a("a",{attrs:{href:"https://tezos.gitlab.io/whitedoc/proof_of_stake.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Proof-of-stake"),a("OutboundLink")],1),t._v(" in Tezos and how "),a("a",{attrs:{href:"https://learn.tqtezos.com/files/self-amendment.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("self-amendmend"),a("OutboundLink")],1),t._v(" works."),a("br"),t._v("\nThere are also several shortcuts for most common cases:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cycle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("276")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("voting_period"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("34")])]),t._v(" "),a("p",[t._v("Lastly, you can examine some rare and interesting cases, e.g. protocol activation:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("protocol_parameters "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blocks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("protocol_parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# genesis block")]),t._v("\nprotocol_parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'commitments'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# recomended allocations (aka commitments)")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("[['btz1LKddKfC9cEitY8Q5bMnGS9yj9uPWnmX68', '4974860242'],\n ['btz1LKj1hxiXZUkZGuCMTNtGos8npjo9VjFnJ', '14770866000'],\n ['btz1LKkKTQ34S1BSrcEwYFpVRhm2inDYfjCMg', '1551209817'],\n ['btz1LKmBsCgNKpkWq3hBBqrPPyEmE1XegouD8', '12000000000'],\n ['btz1LKnYAGSyGRJiY7pieJVK9RR6v3e2ko6QS', '9000000000']]")])]),t._v(" "),a("h2",{attrs:{id:"block-slices-cycles-and-voting-periods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block-slices-cycles-and-voting-periods"}},[t._v("#")]),t._v(" Block slices, cycles, and voting periods")]),t._v(" "),a("p",[t._v("This not a wrapped RPC endpoint but a convenient extension allowing to manipulate with block slices and iterate over larger timeframes namely "),a("a",{attrs:{href:"http://doc.tzalpha.net/whitedoc/proof_of_stake.html#cycles",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("cycles")]),a("OutboundLink")],1),t._v(" and "),a("a",{attrs:{href:"http://doc.tzalpha.net/whitedoc/voting.html#periods",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("voting periods")]),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blocks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("[['BLGD9HqcQiyKa9eQ8pBuNVPR3bkc3XgaT9BgxLaeE2jdvcpCYEX',\n  'BLmJDttDAPHdS7THb1oaRVzhakZoUJTLdxz1sq49Vw6E2vDxBpG',\n  'BLUHiyMJSwhVETPprN14kQcQodM5n6yJtTtyD9rTkJbAwD2UCXX',\n  'BLrX28Eay45rbaCCMuwSH8q6uPTXcB9LiMHy699NfSssbNLzxzF',\n  'BM3YXmkqgKzWevHe28iKDN1JxXa2XV8rjUwpz7PMyrS1y5FS1NQ',\n  'BLk8qc7hdBRtB6cBJ2PL2UTtu1eEkaxkpVYTZz113rZEZswYU2k',\n  'BLyAEwaXShJuZasvUezHUfLqzZ48V8XrPvXF2wRaH15tmzEpsHT',\n  'BMWVEwEYw9m5iaHzqxDfkPzZTV4rhkSouRh3DkVMVGkxZ3EVaNs',\n  'BMM2XoWLyzhYfXDc7p5uZ5a4n8318GoXbJiFUKejAQthjANxpm3',\n  'BKzHjmWqi7wXqrjbKi5NVZ7UGH8hQ9mrkpaABrzSyEfquULxnan',\n  'BKy1nQDvKvic22MzCkqUNeVEENDZzkaoBkVSiK7uBeC8mwWEUNy']]")])]),t._v(" "),a("p",[t._v("Block slice has "),a("code",[t._v("get_range")]),t._v(" method that returns boundary levels which can be useful when working with cycles/voting periods.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cycles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("(1130497, 1131056)")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("voting_periods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("(1, 32768)")])]),t._v(" "),a("p",[t._v("The main purpose of block slices (aside from determining boundaries) is operation search, e.g. when you have recently sent an operation and want to find it by hash:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blocks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1129600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1129700")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find_operation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'onw8xuA8SKNdJo4VUf5vyhJKRmggWRVuLAavCbRnmQvE1zr65KF'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("{'protocol': 'PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb',\n 'chain_id': 'NetXdQprcVkpaWU',\n 'hash': 'onw8xuA8SKNdJo4VUf5vyhJKRmggWRVuLAavCbRnmQvE1zr65KF',\n 'branch': 'BLCWACrJjKFGEwUecZQjna3eiWCy21xCz1cu3TdpmSiLN1KCmJz',\n 'contents': [{'kind': 'transaction',\n   'source': 'tz1bNL8YciKPtCuKNzQWxVF8Bnm1h3sd8sbB',\n   'fee': '8113',\n   'counter': '5373301',\n   'gas_limit': '78140',\n   'storage_limit': '0',\n   'amount': '0',\n   'destination': 'KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL',\n   'parameters': {'entrypoint': 'default',\n    'value': {'prim': 'Right',\n     'args': [{'prim': 'Left',\n       'args': [{'bytes': 'c139928f72887b79db36eb848dbe78aafa429c980421cc7e88a6d117a22949b1'}]}]}},\n   'metadata': {'balance_updates': [{'kind': 'contract',\n      'contract': 'tz1bNL8YciKPtCuKNzQWxVF8Bnm1h3sd8sbB',\n      'change': '-8113'},\n     {'kind': 'freezer',\n      'category': 'fees',\n      'delegate': 'tz1ei4WtWEMEJekSv8qDnu9PExG6Q8HgRGr3',\n      'cycle': 275,\n      'change': '8113'}],\n    'operation_result': {'status': 'applied',\n     'storage': {'prim': 'Pair', 'args': [{'int': '4'}, {'prim': 'Unit'}]},\n     'big_map_diff': [{'action': 'update',\n       'big_map': '4',\n       'key_hash': 'exprtfWG91BKChtLpWyNfQCyCzUfkXWCT6CQp2rVYoN5UWGdfRp5gP',\n       'key': {'bytes': '637a015a2ef8bf984c1c3d9c764afede725dc8e309b24706e9d3333a77f4ae0c'}}],\n     'consumed_gas': '67833',\n     'storage_size': '1859'},\n    'internal_operation_results': [{'kind': 'transaction',\n      'source': 'KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL',\n      'nonce': 0,\n      'amount': '1505762090',\n      'destination': 'tz1bNL8YciKPtCuKNzQWxVF8Bnm1h3sd8sbB',\n      'result': {'status': 'applied',\n       'balance_updates': [{'kind': 'contract',\n         'contract': 'KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL',\n         'change': '-1505762090'},\n        {'kind': 'contract',\n         'contract': 'tz1bNL8YciKPtCuKNzQWxVF8Bnm1h3sd8sbB',\n         'change': '1505762090'}],\n       'consumed_gas': '10207'}}]}}],\n 'signature': 'sigY3K6ZYBg4QbzoC1XUqq6UqT1yTLxyh5uge9ixmbGpNTH7P2BZxRphXzAY7hTDNTx8EiUzundyQMNYxoUZ7Tzus3RRqpKs'}")])]),t._v(" "),a("h2",{attrs:{id:"operation-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#operation-group"}},[t._v("#")]),t._v(" Operation group")]),t._v(" "),a("p",[t._v("If we take a look at the list of operations included into the block we will find a list of lists actually, moreover the size of the outer list is always 4.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("operation_hashes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("[['oo2BUCNwz6G4L5rb3AhicaN9edJNP646vAyz6f4eHRuuybyxWq9',\n  'ooH77gGGD6pMNYtrmWzzz1yxwvqkXzjE94XeYHnvuy3u5SrQkYh',\n  'oo7qN3AGx4eTWLEqaPr8P5FJstdG52D8DPuTMm2aiwtzr9B7rue',\n  'oo2kw6RSkUSz3weWhv1C5dE688AhfS6quyMgx6K27MdQwSLNobw',\n  'op3FbdodNFrPQU1BZiSJnzZyHtx2WpnAEn2Zrzd8Xgm1DiyNM7N',\n  'oo7UmkyVr2Scz9gdbpZHipDmuYHytaQR9BgdfjguDuqKxR5zbH9',\n  'onwNrn3k7wjAZ4vQCbBqJzrFQh3ozcY1ZbiWqw4EA4nR8aYQ59e',\n  'oo1e5NDtFMyyVQMmRMYUKYrMRYdQm4TLQgnUw5R6gPJoupbPcEC',\n  'opL52uGpWFtTSezdihuLaEbfS84s1iXY2ryLiJDQEfBsCCeWdxL',\n  'opWdVVyvvXsrqLy6zZHA63UCxKNbF9Fe6SKNmJbMPC8RbCwmfJk',\n  'onmoRk4W7HLVsroSNsKNyitDLpfC9hf9y1YdXWWmX74zTXEMzHA',\n  'onkeQZuNmDGrWN3uVeBtStHeDAc4BeCJUQEWt3NAeBDaABrY8Na',\n  'onibycjE8JERgnoSp3JBvoZLY5R8czmbdZoca5RrzQWfM3Mz4yW',\n  'ooEoLToW78btzrR2LcDp883orn4DYfMFU7W7ZDxVYY8Ddod9n7Q',\n  'opR8rhznAUanCFuFh8G1HNdfXsMSfjHCydmLKSR5e2fdAvzmuzT',\n  'oodxFfKfSD4kfpHJarE1nVzdNropHK7rtEoKDif53AopZME4xkX',\n  'ooJvBd43SEWv3xksS2Ymnwb4jAvUA6g98yZ2emMLKrurwBCXQFv',\n  'oon9Y4ZQEgEKMCs8R3u6kDy2fyEFgx7gcrFF8JwvafAgBHKwUJF',\n  'ooN3sxtnLVA5L6oJvvD1AGUj6ZRAQvFSEENDJfWDQcV2HKV1fiW',\n  'oojAabp2dKm5NuD8eErwvzuW8uX1pRMyLa8AfQ6EhEr8mTKWtCs',\n  'opL83imySoU8bbHdB98acaqxPCvb4pryRPAx4RZosyQT4MepsF3',\n  'oogHbf2QUdMMRu8B7rssQyFzVjUvjbqJ4LxVZfCxW2detoxjfg4',\n  'onyyRRrRuEXmq8RpB93hzBMXqVx2PJWvvnbUk7odL39n1CSpaYF'],\n [],\n [],\n ['ongCdvSZSSuNC31CHGoUSTeJGCTwZnXFkoa1iY6481EJgv2pQLH',\n  'ooUdyPxwpt8JP1Ew3tfijtJrJwG3kh8yhMRmDDBjKXquNohShms',\n  'oobKg4oRTFNHYQNYV8zuqHBwdoofxeH3AygQ9WpDz36sdHNAc9e',\n  'onuCEMPsYNEg7NNinFww2VcoK7JEGHFuBCqx1LvhRWhtvQygNFf',\n  'opJcqE9wMkS8PrLpNTzgtMeusDTYc6i6JnP39PssCeDTJ3KRYhB',\n  'opWk1k9YiS6XGYS4VyaZmZG2ZN4wYUem6Lu2Uk7TxVKBUk6BujR',\n  'op8o1YB2AV9rHFJQ5JCCpTbEVL67VvCmiDxqcBzV8awuMszf4jE']]")])]),t._v(" "),a("p",[t._v("These are the so-called validation passes, the operations are grouped in such a way as to detect the error as early as possible.")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("Endorsement")]),t._v(' — contains only operations with kind "endorsement", which affect the fitness of the block;')]),t._v(" "),a("li",[a("strong",[t._v("Vote")]),t._v(' — contains "ballot" and "proposal" operations used in the self-amending mechanism;')]),t._v(" "),a("li",[a("strong",[t._v("Anonymous")]),t._v(" — contains operations that do not have signatures thus cannot be linked to any particular account (until some level);")]),t._v(" "),a("li",[a("strong",[t._v("Manager")]),t._v(" — contains signed operations that do change account states.")])]),t._v(" "),a("p",[t._v("Read more about various "),a("a",{attrs:{href:"https://medium.com/tqtezos/lifecycle-of-an-operation-in-tezos-248c51038ec2",target:"_blank",rel:"noopener noreferrer"}},[t._v("operation kinds"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("operations\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("<pytezos.rpc.protocol.OperationListListQuery object at 0x7fcf3b595588>\n"),a("p",[t._v("Properties\n.path  # /chains/main/blocks/head/operations\n.node  # https://mainnet-tezos.giganode.io/ ()")]),t._v("\n"),a("p",[t._v("()\nAll the operations included in the block.\n:returns: Array")]),t._v("\n"),a("p",[t._v("[] Find operation by hash.")]),t._v("\n"),a("p",[t._v(":param item: Operation group hash (base58)\n:rtype: OperationQuery")]),t._v("\n"),a("p",[t._v("Helpers\n.anonymous\n.endorsements\n.find_ballots()\n.find_origination()\n.find_upvotes()\n.managers\n.votes")])])]),a("p"),t._v(" "),a("p",[t._v("Note shortcuts for validation passes, also you can search through all operations by hash.")]),t._v(" "),a("p",[t._v('So far we used the term "operation" although were actually speaking about "operation groups". Here\'s how an operation group is constructed:')]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('Operation Group  <-- hash refers to the entire group\n└ Content #0\n  └ Main operation\n  └ Internal operation results  <-- only if main operation is "manager" and applied\n    └ Internal operation #0\n    ...\n    └ Internal operation #m\n...\n└ Content #n\n')])])]),a("p",[t._v("Multicontent structure essentially allows operation batching, however an important rule must be followed: "),a("strong",[t._v("only operations with the same validation pass can be batched")]),t._v(".")]),t._v(" "),a("p",[t._v("Internal operations may occur as a result of calls to smart contracts, which may invoke other contracts in their turn. Pay attention to the flat structure (intuitively expected tree-like) of internal operations. In Tezos contracts cannot synchronously invoke other contracts but return a list of spawned operations (i.e. async cross-contract calls) instread. The ordering of contract calls is quite unusual, "),a("a",{attrs:{href:"https://forum.tezosagora.org/t/problems-with-concurrency/1771",target:"_blank",rel:"noopener noreferrer"}},[t._v("BFS"),a("OutboundLink")],1),t._v(" is used (usually DFS):")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("A      1\n└ B    2\n  └ C  4\n  └ D  5\n  E    3\n  └ F  6\n  └ G  7\n")])])]),a("p",[t._v("How to determine the order of a particular operation from the RPC response:")]),t._v(" "),a("ol",[a("li",[t._v("Main operations — by "),a("strong",[t._v("counter")]),t._v(", which is tied to a specific account (signatory) and is incremented by one after each successful operation;")]),t._v(" "),a("li",[t._v("Internal operations — by "),a("strong",[t._v("nonce")]),t._v(", which is being reset on every main operation.")])]),t._v(" "),a("p",[t._v("PyTezos provides convenient iterators for operations and operation results (receipts):")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("operation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("result "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" OperationResult\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("opg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell \\\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blocks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1113876")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \\\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("operations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'opHN29qMFpK6fMswaWmb2WYis7JggqF6fzJtysaB5LRAkzC17Zk'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" op "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" OperationResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iter_contents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("op"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kind'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'internal'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" op"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'internal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("transaction \ntransaction internal\ntransaction internal\n")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" res "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" OperationResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iter_results"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'status'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"stdout"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stdout")]),a("br"),t._v("applied\napplied\napplied\n")])]),t._v(" "),a("p",[t._v("You can also aggregate some stats or extract specific fields:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("opg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell \\\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blocks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("850141")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \\\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("operations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'opGUCeryD3N4pAjLPZNqWVcgkxjPyTVf4y9uRxDzguWaBQvStgj'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nOperationResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("burned"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("257")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("OperationResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originated_contracts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("['KT1XHAmdRKugP1Q38CxDmpcRSxq143KpEiYx']")])]),t._v(" "),a("h2",{attrs:{id:"context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[t._v("#")]),t._v(" Context")]),t._v(" "),a("p",[t._v("Context is the blockchain state, it keeps actual information about accounts, balances, contract data, and other. Note, that a node has to run in a special "),a("a",{attrs:{href:"https://tezos.gitlab.io/user/history_modes.html",target:"_blank",rel:"noopener noreferrer"}},[t._v('"archive"'),a("OutboundLink")],1),t._v(" mode in order to provide access to the context. Also note that many data providers close particularly heavy context endpoints.")]),t._v(" "),a("p",[t._v("The most common scenario using context data is querying account state (balance, storage, code, baker-specific info):")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contracts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tz1cf7vkqZiDwSJRpKN4W3NNHPHAXgomM3GE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("{'balance': '24969932',\n 'delegate': 'tz1NortRftucvAkD1J58L32EhSVrQEWJCEnB',\n 'counter': '6761142'}")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contracts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'KT1VG2WtYdSWz5E7chTeAdDPZNy2MpP8pTfL'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("{'prim': 'Pair', 'args': [{'int': '4'}, {'prim': 'Unit'}]}")])]),t._v(" "),a("p",[t._v("There is no public documentation for context endpoints, but you can utilize the one integrated to PyTezos:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("<pytezos.rpc.protocol.ContextRawJsonQuery object at 0x7fcf48d4b4e0>\n"),a("p",[t._v("Properties\n.path  # /chains/main/blocks/head/context/raw/json\n.node  # https://mainnet-tezos.giganode.io/ ()")]),t._v("\n"),a("p",[t._v("()\n¯_(ツ)"),a("em",[t._v("/¯\n:param depth: ¯_(ツ)")]),t._v("/¯\n:returns: Object")]),t._v("\n"),a("p",[t._v("RPC endpoints\n.active_delegates_with_rolls\n.big_maps\n.block_priority\n.commitments\n.contracts\n.cycle\n.delegates\n.delegates_with_frozen_balance\n.ramp_up\n.rolls\n.votes")])])]),a("p"),t._v(" "),a("p",[t._v("For example, you can query all keys of a particular big map:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("raw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("big_maps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("div",{staticClass:"result"},[a("pre",[t._v("['exprvSvW5ffvG4epdyhVxqutvzeWXdCTx8AshBRn2JNxpuTkzyt92o',\n 'exprvNUxqffUzU5UzdSFh2jYWpA9YmFtj5thBqCAhKAdEZZRLdD2pv',\n 'exprvMg58jmxM2S5y7Cev4H8E4rQgchCmjkFYTTXX4ZUoR59NfEi27',\n 'exprvKJfvczXea5o7zn9R7Q3cA1C3zPbR9Y4XjtfGiyFcdcPp6ef6U',\n 'exprvJmH6JcTnhLkR6BFioC9qqmT1b1AvcxmjCcekxS84oHwNbonFC']")])]),t._v(" "),a("h2",{attrs:{id:"boosting-rpc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#boosting-rpc"}},[t._v("#")]),t._v(" Boosting RPC")]),t._v(" "),a("p",[t._v("PyTezos uses several tricks to improve experience with RPC requests. First, it caches deterministic requests (i.e. to past blocks) but only for known public networks. This option can be turned off:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("caching "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n")])])]),a("p",[t._v("In addition to that, you can use a pool of RPC nodes to make concurrent requests:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" concurrent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("futures "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ThreadPoolExecutor\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" logging\n\nlogging"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("basicConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logging"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEBUG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nregistry "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pytezos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("using"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mainnet-pool'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \\\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contract"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nbakers_addresses "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tz1abmz7jiCV2GH2u81LRrGgAFFgvQgiDiaf'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tz1WvL7MKyCuUHfC3FxPFyiXcy8hHTBT3vjE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tz1PWCDnz783NNGGQjEFFsHtrcK5yBW4E2rm'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("big_map_get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("big_map_get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'head'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" ThreadPoolExecutor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("max_workers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" executor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    snapshot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" executor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("big_map_get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bakers_addresses"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("div",{staticClass:"stderr"},[a("pre",[a("span",{staticClass:"stream-name"},[t._v("stderr")]),a("br"),t._v('DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): rpc.tzkt.io:443\nDEBUG:urllib3.connectionpool:https://rpc.tzkt.io:443 "GET /mainnet/chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog HTTP/1.1" 200 None\nDEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): tezos-prod.cryptonomic-infra.tech:443\nDEBUG:urllib3.connectionpool:Starting new HTTPS connection (2): tezos-prod.cryptonomic-infra.tech:443\nDEBUG:urllib3.connectionpool:Starting new HTTPS connection (3): tezos-prod.cryptonomic-infra.tech:443\nDEBUG:urllib3.connectionpool:https://tezos-prod.cryptonomic-infra.tech:443 "GET /chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog/storage HTTP/1.1" 200 None\nDEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): rpc.tezrpc.me:443\nDEBUG:urllib3.connectionpool:https://tezos-prod.cryptonomic-infra.tech:443 "GET /chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog/storage HTTP/1.1" 200 None\nDEBUG:urllib3.connectionpool:https://tezos-prod.cryptonomic-infra.tech:443 "GET /chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog/storage HTTP/1.1" 200 None\nDEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.tezos.org.ua:443\nDEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.tez.ie:443\nDEBUG:urllib3.connectionpool:https://rpc.tezrpc.me:443 "POST /chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog/big_map_get HTTP/1.1" 200 None\nDEBUG:urllib3.connectionpool:https://api.tezos.org.ua:443 "POST /chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog/big_map_get HTTP/1.1" 301 None\nDEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): mainnet-tezos.giganode.io:443\nDEBUG:urllib3.connectionpool:https://api.tez.ie:443 "POST /chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog/big_map_get HTTP/1.1" 200 819\nDEBUG:urllib3.connectionpool:https://mainnet-tezos.giganode.io:443 "GET /chains/main/blocks/head/context/contracts/KT1ChNsEFxwyCbJyWGSL3KdjeXE28AY1Kaog/big_map_get HTTP/1.1" 405 None\n')])]),t._v(" "),a("Binder",{attrs:{filepath:"notebooks/02_rpc.ipynb"}})],1)}),[],!1,null,null,null);n.default=e.exports}}]);